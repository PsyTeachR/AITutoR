{
  "hash": "2ff482482354a2fae6cddac95cd07072",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Error checking and debugging\n\n*Written by Emily Nordmann*\n\nIn this chapter, you'll learn how to use AI to help you identify and fix coding errors. I'd argue this is probably the best use case of AI - using it to help and debug code you've written yourself - because it's human expertise that wrote the code, but with the AIs attention to detail and ability to spot missing commas.\n\nAI is also generally very good at this task, although the more complicated your code, the more likely it will run into trouble. This chapter will give a few examples to help you with your prompt engineering.\n\n## Activity 1: Set-up {#sec-setup-errors}\n\nUnlike the other chapters you don't need to do any set-up, in fact, you can often just copy and paste the code and error in and it will figure out that you want it to fix it without even needing to explicitly ask.\n\nSo that you can reproduce the same errors, let's create a reproducible example and load some packages and a dataset. Open an Rmd (not a script, we'll use the Rmd in Activity 3) and run the below (you may need to install the package `palmerpenguins` if you don't have it already).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'palmerpenguins' was built under R version 4.3.3\n```\n\n\n:::\n\n```{.r .cell-code}\ndata(\"penguins\")\n```\n:::\n\n\n## Activity 2: Simple errors {#sec-simple-errors}\n\nUnlike the other chapters you don't need to do any set-up, in fact, you can often just copy and paste the code and error in and it will figure out that you want it to fix it without even needing to explicitly ask. \n\nHere's a simple error where we have given it the wrong function name:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = species)) +\n   geom_barchart()\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in geom_barchart(): could not find function \"geom_barchart\"\n```\n\n\n:::\n:::\n\n\n* Give the AI both the code and the error. One without the other is likely to result in a poor or incomplete answer (whether you ask a human or an AI).\n\nAll three AIs identified, explained, and fixed this error. Gemini also tried to give some additional information about the function and with a link to more information, which is nice.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Fixing a simple error](include/images/04-error/simple.png){width=459}\n:::\n:::\n\n\n## Activity 3: Contextual errors\n\nSomething that catches many people out is when the error is actually being caused by code further up your script rather than the bit that is results in the error.\n\nFor example, in this code, what we intend to do is create a dataset that just has penguins from Biscoe Island and then calculate the mean body mass. This code will run, but it produces `NaN` as the value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbiscoe_penguins <- penguins %>%\n  filter(island == \"biscoe\")\n\nbiscoe_penguins %>%\n  summarise(mean_mass = mean(body_mass_g))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| mean_mass|\n|---------:|\n|       NaN|\n\n</div>\n:::\n:::\n\n\nIf you just give it the code and the table and ask it to explain what's happening, it will do its best but without knowing the dataset or what code has preceded it, it won't give you the exact answer, although in this case it hints at it.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![ChatGPT giving it the best guess](include/images/04-error/context1.png){width=536}\n:::\n:::\n\n\nThere's a few things you can do at this point:\n\n* Give it all the code you've used so far\n* Run `str(penguins)` and `str(biscoe_penguins)` and also give it the structure of the datasets\n\nIf you haven't spotted it by now, the error is that in the filter `biscoe` should be `Biscoe` with a capital B. It still doesn't have the information it needs to tell you this explicitly, but it will get you very close. **There is no shortcut for knowing your data**.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Copilot getting very close](include/images/04-error/context2.png){width=885}\n:::\n:::\n\n\n## Activity 4: Incorrect (but functional) code\n\nSometimes (often) when we write code, the issue isn't that our code doesn't work, it's that it doesn't do what we intended and we can't figure out why. \n\nFor example, let's say that we want to calculate the average body_mass_g for each species by sex and we write following:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  group_by(sex, species) %>%\n  summarise(mean_body_mass = sd(body_mass_g, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'sex'. You can override using the `.groups`\nargument.\n```\n\n\n:::\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|sex    |species   | mean_body_mass|\n|:------|:---------|--------------:|\n|female |Adelie    |       269.3801|\n|female |Chinstrap |       285.3339|\n|female |Gentoo    |       281.5783|\n|male   |Adelie    |       346.8116|\n|male   |Chinstrap |       362.1376|\n|male   |Gentoo    |       313.1586|\n|NA     |Adelie    |       477.1661|\n|NA     |Gentoo    |       338.1937|\n\n</div>\n:::\n:::\n\n\nWe know something isn't right here. Because we're responsible researchers, we've taken time to understand our dataset and what plausible values should be and we know there's no way that the average body mass of a penguin is 269 grams (unless the penguin is made of chocolate) but the code is running fine and we can't see what we've done.\n\nYou can ask the AI to help you but you will need to tell it what you intended. In this case, all three AIs correctly identified that I had used `sd` instead of `mean`. The more complex your code, the more information you will need to give it in order for it to help you find the error. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Fixing a functional error](include/images/04-error/functional_error.png){width=622}\n:::\n:::\n\n\nThis is a good example of why **there is no AI tool that allows you to skip understanding the data you're working with and knowing what it is you're trying to do**.\n\n## Activity 5: Rmd errors\n\nIf you're working in R Markdown or Quarto, sometimes the errors will stem from your code chunk settings or YAML.\n\nIn your Rmd file, create a new code chunk and paste the following:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  count()\n```\n:::\n\n\nBut then delete one of the final back ticks from the code chunk.\n\nThe code is fine, it provides a simple count of the number of observations in the dataset. But if you try and knit the file, you'll get a long `! attempt to use zero-length variable name`. Copilot wasn't that helpful because all of its suggestions relate to checking your code:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Missing the mark](include/images/04-error/rmd1.png){width=800}\n:::\n:::\n\n\nHowever, Gemini was more useful as one of its suggestions is indeed the solution - there's a missing back tick at the end of the code chunk. In cases like this, it won't give you a solution you can copy and paste but it will tell you what to go and look for. \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Missing backticks](include/images/04-error/rmd1.png){width=800}\n:::\n:::\n\n\n::: {.callout-important}\nI know I might be starting to sound like a broken record but **please** remember that artificial intelligence is not actually intelligent. It's not thinking, it's not making conscious decisions, it has no expert subject matter knowledge. No matter how helpful it is, you must always check the output of the code it gives you.\n:::\n\n::: {.callout-caution}\nThis book should be considered a **living document** and is likely to change over time. Given the brave new world in which we now live, all constructive feedback and suggestions are welcome! If you have any feedback or suggestions, please provide it [via Forms](https://forms.office.com/Pages/ResponsePage.aspx?id=KVxybjp2UE-B8i4lTwEzyKAHhjrab3lLkx60RR1iKjNUM0VCMUUxUUFLMTdNM0JTS09PSDg2SFQ3US4u).\n:::\n",
    "supporting": [
      "04-errors_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}